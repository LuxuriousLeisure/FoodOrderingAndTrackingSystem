<section id="page-staff" class="page">
  <h2>Staff Console</h2>
  <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
    <div class="card">
      <h4>Order Management</h4>
      <div id="orderBoard"></div>
    </div>
    <div class="card">
      <h4>Delivery Management</h4>
      <div id="deliveryBoard"></div>
    </div>
  </div>
</section>

<script>
// 员工控制台逻辑
document.addEventListener('DOMContentLoaded', () => {
  const orderBoard = document.getElementById('orderBoard');
  const deliveryBoard = document.getElementById('deliveryBoard');
  let orderSequence = 1;

  // 创建新订单（供支付页面调用）
  window.createStaffOrder = () => {
    if (!window.dishManager || !window.dishManager.currentRestaurant) return;

    const cartItems = Array.from(window.dishManager.cart.values())
      .map(({ dish, qty }) => `${qty}×${dish.name}`)
      .join(', ');
      
    const total = window.dishManager.formatMoney(
      Array.from(window.dishManager.cart.values())
        .reduce((sum, { dish, qty }) => sum + (dish.price * qty), 0)
    );

    const orderId = `ORD${String(orderSequence++).padStart(3, '0')}`;
    const restaurantName = window.dishManager.currentRestaurant.name;

    // 创建订单卡片
    const orderCard = document.createElement('div');
    orderCard.className = 'card';
    orderCard.innerHTML = `
      <div><strong>${orderId}</strong> — ${cartItems}</div>
      <div class="muted">Total ${total} • From ${restaurantName}</div>
      <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
        <button class="btn ghost" data-act="accept">Accept</button>
        <button class="btn ghost" data-act="prep">Ready</button>
        <button class="btn ghost" data-act="dispatch">Dispatch</button>
      </div>
    `;
    orderBoard.prepend(orderCard);

    // 清空购物车
    window.dishManager.cart.clear();
    window.dishManager.updateCart();
  };

  // 添加配送记录
  function addDeliveryNote(text) {
    const note = document.createElement('div');
    note.className = 'card';
    note.textContent = text;
    deliveryBoard.prepend(note);
  }

  // 订单操作事件
  orderBoard.addEventListener('click', (e) => {
    const btn = e.target.closest('button[data-act]');
    if (!btn) return;

    const action = btn.dataset.act;
    const statusTexts = {
      accept: 'Accepted',
      prep: 'Ready for pickup',
      dispatch: 'Dispatched for delivery'
    };

    // 添加状态标记
    const statusNote = document.createElement('div');
    statusNote.className = 'muted';
    statusNote.textContent = statusTexts[action];
    btn.closest('.card').appendChild(statusNote);

    //  dispatch时添加到配送记录
    if (action === 'dispatch') {
      const orderId = btn.closest('.card').querySelector('strong').textContent;
      addDeliveryNote(`Order ${orderId} has been dispatched`);
      location.hash = 'tracking';
    }
  });
});
</script>
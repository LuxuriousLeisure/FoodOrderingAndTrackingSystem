<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Food Ordering System</title>
  <link rel="stylesheet" href="/css/Project.css">
</head>
<body>
  <header>
    <div class="wrap topbar">
      <a class="brand" href="/">
        <img src="/css/Logo.png" width='80' height='60'>
        <strong>Food Ordering System</strong>
      </a>
      <div style="display:flex;gap:8px">
        <span id="authState" class="muted">
          <% if (user) { %>Logged in as <%= user.name %> (<%= user.role %>)<% } else { %>Not logged in<% } %>
        </span>
        <% if (user) { %>
          <a class="pill" href="/logout">Logout</a>
        <% } else { %>
          <a class="pill" href="/login?as=user">User</a>
          <a class="pill" href="/login?as=staff">Staff</a>
        <% } %>
      </div>
    </div>
  </header>

  <main class="wrap page active">
    <div class="hero">
      <div class="carousel" id="carousel">
        <div class="carousel-viewport">
          <div class="carousel-track" id="carouselTrack">
            <section class="slide">
              <h1>Choose a restaurant</h1>
              <p class="muted">Browse first. When you choose a dish (Add) we’ll ask you to log in.</p>
              <div class="badges">
                <span class="badge">Top Rated</span>
                <span class="badge">4.7+ Stars</span>
              </div>
              <div class="visual">
                <canvas width="1200" height="320" data-label="Top Rated"></canvas>
              </div>
            </section>
            <section class="slide">
              <h1>Fast Delivery</h1>
              <p class="muted">Hungry now? These restaurants have the quickest ETAs near you.</p>
              <div class="badges">
                <span class="badge">10–20 min</span>
                <span class="badge">Live Tracking</span>
              </div>
              <div class="visual">
                <canvas width="1200" height="320" data-label="Fast Delivery"></canvas>
              </div>
            </section>
          </div>
        </div>
        <div class="carousel-nav">
          <button class="carousel-btn" id="prevBtn">‹</button>
          <button class="carousel-btn" id="nextBtn">›</button>
        </div>
        <div class="carousel-dots" id="carouselDots"></div>
      </div>
    </div>

    <h2 style="margin-top:18px">Restaurants</h2>
    <div class="restaurants-vertical" id="restaurantList">
      <% restaurants.forEach(rest => { %>
        <div class="card restaurant">
          <div style="border-radius:12px;overflow:hidden;height:140px;background:#f3f4f6">
            <canvas width="1000" height="320" data-name="<%= rest.name %>"></canvas>
          </div>
          <div class="meta">
            <div>
              <div style="font-weight:800"><%= rest.name %></div>
              <div class="muted"><%= rest.cuisine %> • <%= rest.eta %></div>
            </div>
            <div>⭐ <%= rest.rating %></div>
          </div>
          <a href="/restaurant/<%= rest._id %>" class="btn primary">View menu</a>
        </div>
      <% }) %>
    </div>
  </main>

  <script>
    // 轮播图逻辑
 const track = document.getElementById('carouselTrack');
    const slides = track.children;
    const dotsWrap = document.getElementById('carouselDots');
    let index = 0;
    let AutoTimer=null;

    function setIndex(i) {
      index = (i + slides.length) % slides.length;
      track.style.transform = `translateX(-${index * 100}%)`;
      updateDots();
    }

    function updateDots() {
      dotsWrap.innerHTML = '';
      [...slides].forEach((_, i) => {
        const dot = document.createElement('button');
        dot.className = 'dot' + (i === index ? ' active' : '');
        dot.onclick = () => setIndex(i);
        dotsWrap.appendChild(dot);
      });
    }
    
    function startAuto(){
	
    	  AutoTimer=setInterval(()=>setIndex(index+1), 3000); 
	
    };
    function stopAuto(AutoTimer){
    	if(AutoTimer){
	    	clearInterval(AutoTimer); 
	    	AutoTimer=null;
	}
    };

    document.getElementById('nextBtn').onclick = () => {
    	stopAuto(AutoTimer);
    	setIndex(index + 1);
    	startAuto();
    };
    document.getElementById('prevBtn').onclick = () => {
    	stopAuto(AutoTimer);
    	setIndex(index - 1);
    	startAuto();
    };
    updateDots();
    startAuto();


    // 画布渲染
    document.querySelectorAll('.visual canvas').forEach(canvas => {
      const ctx = canvas.getContext('2d');
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#e63946');
      gradient.addColorStop(1, '#ff9f1c');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 24px Arial';
      ctx.fillText(canvas.dataset.label, 20, 40);
    });

    // 餐厅图片渲染
    document.querySelectorAll('[data-name]').forEach(canvas => {
      const ctx = canvas.getContext('2d');
      const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      gradient.addColorStop(0, '#e0e7ff');
      gradient.addColorStop(1, '#6366f1');
      ctx.fillStyle = gradient;
      ctx.fillRect(0, 0, canvas.width, canvas.height);
      ctx.fillStyle = 'white';
      ctx.font = 'bold 24px Arial';
      ctx.fillText(canvas.dataset.name, 20, 40);
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
  <title>Checkout</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="/css/Project.css"/>


</head>
<body>
  <main class="wrap">
  <section id="page-payment" class="page active">
  	  <div class="card">
  	  	<h2>Checkout</h2>
  	  	<div class="form">
		  <p>Total: $<%= total.toFixed(2) %></p>
		    <div id="cart-items">
		      <% cart.forEach(item => { %>
			<p><%= item.name %> x <%= item.quantity %> = $<%= (item.price*item.quantity).toFixed(2) %><p>
			    <% }) %>
		            <label>Note<textarea rows="3" id="orderNote" placeholder="Allergies, preferences..."></textarea></label>
	            </div>
	         </div>
	         <button class="btn primary" id="checkout-button">Pay</button>
	         
  	  </div>
	  
  </section>
  
  <script src="https://js.stripe.com/v3/"></script>
  <script>
    const stripe = Stripe('<%= stripePublishableKey %>');
    const checkoutButton = document.getElementById('checkout-button');

    checkoutButton.addEventListener('click', () => {
      fetch('/create-checkout-session', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
      })
      .then(res => res.json())
      .then(session => stripe.redirectToCheckout({ sessionId: session.id }))
      .catch(err => alert('Error: ' + err));
    });
  </script>
  </main>
</body>
</html>
